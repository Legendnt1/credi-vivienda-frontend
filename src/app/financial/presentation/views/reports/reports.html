<div class="reports-container">
  <h1 class="page-title">
    <svg class="title-icon">
      <use href="assets/icons/sprite.symbol.svg#file-text"></use>
    </svg>
    {{ 'reports.title' | translate }}
  </h1>

  <!-- Filter Form -->
  <div class="filter-card">
    <h2 class="filter-title">{{ 'reports.filter.title' | translate }}</h2>
    <div class="filter-form">
      <div class="filter-grid">
        <div class="form-field">
          <label class="form-label">{{ 'reports.filter.period' | translate }}</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="periodFilter"
            [placeholder]="'reports.filter.periodPlaceholder' | translate"
          />
        </div>

        <div class="form-field">
          <label class="form-label">{{ 'reports.filter.property' | translate }}</label>
          <select class="form-input" [(ngModel)]="propertyFilter">
            <option value="">{{ 'reports.filter.all' | translate }}</option>
            @for (property of properties(); track property.id) {
              <option [value]="property.id">{{ property.project }} - {{ property.property_code }}</option>
            }
          </select>
        </div>

        <div class="form-field">
          <label class="form-label">{{ 'reports.filter.credit' | translate }}</label>
          <select class="form-input" [(ngModel)]="creditFilter">
            <option value="">{{ 'reports.filter.all' | translate }}</option>
            @for (credit of credits(); track credit.id) {
              <option [value]="credit.id">{{ credit.program }}</option>
            }
          </select>
        </div>

        <div class="filter-actions">
          <button type="button" class="btn-clear" (click)="clearFilters()">
            <svg class="btn-icon">
              <use href="assets/icons/sprite.symbol.svg#x"></use>
            </svg>
            {{ 'reports.filter.clear' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reports Summary -->
  <div class="reports-summary">
    <span class="summary-text">
      {{ 'reports.summary.showing' | translate }}
      <strong>{{ filteredReports().length }}</strong>
      {{ 'reports.summary.of' | translate }}
      <strong>{{ reports().length }}</strong>
      {{ 'reports.summary.reports' | translate }}
    </span>
  </div>

  <!-- Reports List -->
  @if (filteredReports().length === 0) {
    <div class="empty-state">
      <svg class="empty-icon">
        <use href="assets/icons/sprite.symbol.svg#inbox"></use>
      </svg>
      <p class="empty-text">{{ 'reports.empty' | translate }}</p>
      <p class="empty-hint">{{ 'reports.emptyHint' | translate }}</p>
    </div>
  } @else {
    <div class="reports-grid">
      @for (report of filteredReports(); track report.id) {
        <div class="report-card">
          <div class="report-header">
            <div class="report-id">
              <svg class="report-icon">
                <use href="assets/icons/sprite.symbol.svg#file-text"></use>
              </svg>
              <span>{{ 'reports.reportNumber' | translate }} #{{ report.id }}</span>
            </div>
            <div class="report-date">{{ formatDate(report.generated_at) }}</div>
          </div>

          <div class="report-body">
            <div class="report-info-row">
              <span class="info-label">{{ 'reports.card.property' | translate }}:</span>
              <span class="info-value">{{ getPropertyName(report.property_project_id) }}</span>
            </div>
            <div class="report-info-row">
              <span class="info-label">{{ 'reports.card.credit' | translate }}:</span>
              <span class="info-value">{{ getCreditName(report.credit_id) }}</span>
            </div>
            <div class="report-info-row">
              <span class="info-label">{{ 'reports.card.price' | translate }}:</span>
              <span class="info-value">{{ getReportCurrencySymbol(report.currency_catalog_id) }} {{ report.price | number:'1.2-2' }}</span>
            </div>
            <div class="report-info-row">
              <span class="info-label">{{ 'reports.card.term' | translate }}:</span>
              <span class="info-value">{{ report.years }} {{ 'reports.card.years' | translate }}</span>
            </div>
            <div class="report-info-row">
              <span class="info-label">{{ 'reports.card.tea' | translate }}:</span>
              <span class="info-value">{{ report.base_tea }}%</span>
            </div>
          </div>

          <div class="report-metrics">
            <div class="metric">
              <span class="metric-label">VAN</span>
              <span class="metric-value">{{ getReportCurrencySymbol(report.currency_catalog_id) }} {{ report.van | number:'1.2-2' }}</span>
            </div>
            <div class="metric">
              <span class="metric-label">TIR</span>
              <span class="metric-value">{{ (report.tir) | number:'1.2-2' }}%</span>
            </div>
            <div class="metric">
              <span class="metric-label">TCEA</span>
              <span class="metric-value">{{ (report.tcea) | number:'1.2-2' }}%</span>
            </div>
          </div>

          <div class="report-footer">
            <button class="btn-download" (click)="downloadReport(report)">
              <svg class="btn-icon">
                <use href="assets/icons/sprite.symbol.svg#download"></use>
              </svg>
              {{ 'reports.download' | translate }}
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>


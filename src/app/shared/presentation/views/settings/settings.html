<div class="settings-container">
  <div class="settings-content">
    <div class="settings-card">
      <h2 class="settings-title">{{ 'settings.title' | translate }}</h2>

      <!-- Success Message -->
      @if (successMessage()) {
        <div class="alert alert-success">
          <svg class="alert-icon">
            <use href="assets/icons/sprite.symbol.svg#check"></use>
          </svg>
          <span>{{ successMessage() }}</span>
        </div>
      }

      <!-- Error Message -->
      @if (errorMessage()) {
        <div class="alert alert-error">
          <svg class="alert-icon">
            <use href="assets/icons/sprite.symbol.svg#alert-circle"></use>
          </svg>
          <span>{{ errorMessage() }}</span>
        </div>
      }

      <form [formGroup]="settingsForm" (ngSubmit)="onSaveSettings()" class="settings-form">
        <!-- Currency Selection -->
        <div class="form-group">
          <label for="currency" class="form-label">
            {{ 'settings.form.currency.label' | translate }}
          </label>
          <div class="select-wrapper">
            <select
              id="currency"
              formControlName="default_currency_catalog_id"
              class="form-select"
              [class.invalid]="settingsForm.get('default_currency_catalog_id')?.invalid && settingsForm.get('default_currency_catalog_id')?.touched">
              <option value="" disabled selected>{{ 'settings.form.currency.placeholder' | translate }}</option>
              @for (currency of currencies(); track currency.id) {
                <option [value]="currency.id">{{ currency.currency }}</option>
              }
            </select>
            <svg class="select-icon">
              <use href="assets/icons/sprite.symbol.svg#chevron-down"></use>
            </svg>
          </div>
        </div>

        <!-- Interest Type -->
        <div class="form-group">
          <label for="interestType" class="form-label">
            {{ 'settings.form.interestType.label' | translate }}
          </label>
          <div class="select-wrapper">
            <select
              id="interestType"
              formControlName="default_interest_type"
              class="form-select"
              [class.invalid]="settingsForm.get('default_interest_type')?.invalid && settingsForm.get('default_interest_type')?.touched">
              @for (type of interestTypes; track type.value) {
                <option [value]="type.value">{{ type.label | translate }}</option>
              }
            </select>
            <svg class="select-icon">
              <use href="assets/icons/sprite.symbol.svg#chevron-down"></use>
            </svg>
          </div>
        </div>

        <!-- Grace Period -->
        <div class="form-group">
          <label for="gracePeriod" class="form-label">
            {{ 'settings.form.gracePeriod.label' | translate }}
          </label>
          <div class="select-wrapper">
            <select
              id="gracePeriod"
              formControlName="default_grace_period"
              class="form-select"
              [class.invalid]="settingsForm.get('default_grace_period')?.invalid && settingsForm.get('default_grace_period')?.touched">
              @for (period of gracePeriods; track period.value) {
                <option [value]="period.value">{{ period.label | translate }}</option>
              }
            </select>
            <svg class="select-icon">
              <use href="assets/icons/sprite.symbol.svg#chevron-down"></use>
            </svg>
          </div>
        </div>

        <!-- Opportunity TEA -->
        <div class="form-group">
          <label for="opportunityTea" class="form-label">
            {{ 'settings.form.opportunityTea.label' | translate }}
          </label>
          <input
            type="number"
            id="opportunityTea"
            formControlName="default_opportunity_tea"
            class="form-input"
            step="0.01"
            min="0.01"
            placeholder="{{ 'settings.form.opportunityTea.placeholder' | translate }}"
            (blur)="onOpportunityTeaBlur()"
            [class.invalid]="settingsForm.get('default_opportunity_tea')?.invalid && settingsForm.get('default_opportunity_tea')?.touched">
          @if (settingsForm.get('default_opportunity_tea')?.invalid && settingsForm.get('default_opportunity_tea')?.touched) {
            <span class="error-message">{{ 'settings.form.opportunityTea.error' | translate }}</span>
          }
        </div>

        <!-- Days in Year -->
        <div class="form-group">
          <label for="daysInYear" class="form-label">
            {{ 'settings.form.daysInYear.label' | translate }}
          </label>
          <div class="select-wrapper">
            <select
              id="daysInYear"
              formControlName="default_days_in_year"
              class="form-select"
              [class.invalid]="settingsForm.get('default_days_in_year')?.invalid && settingsForm.get('default_days_in_year')?.touched">
              @for (days of daysInYearOptions; track days.value) {
                <option [value]="days.value">{{ days.label }}</option>
              }
            </select>
            <svg class="select-icon">
              <use href="assets/icons/sprite.symbol.svg#chevron-down"></use>
            </svg>
          </div>
        </div>

        <!-- Exchange Rate USD/PEN -->
        <div class="form-group">
          <label for="exchangeRate" class="form-label">
            {{ 'settings.form.exchangeRate.label' | translate }}
          </label>
          <input
            type="number"
            id="exchangeRate"
            formControlName="default_change_usd_pen"
            class="form-input"
            step="0.01"
            min="0.01"
            placeholder="{{ 'settings.form.exchangeRate.placeholder' | translate }}"
            (blur)="onExchangeRateBlur()"
            [class.invalid]="settingsForm.get('default_change_usd_pen')?.invalid && settingsForm.get('default_change_usd_pen')?.touched">
          @if (settingsForm.get('default_change_usd_pen')?.invalid && settingsForm.get('default_change_usd_pen')?.touched) {
            <span class="error-message">{{ 'settings.form.exchangeRate.error' | translate }}</span>
          }
        </div>

        <!--  Language switcher  -->
        <app-language-switcher />

        <!-- Submit Button -->
        <button
          type="submit"
          class="btn-save"
          [disabled]="loading()">
          @if (loading()) {
            <span>{{ 'settings.form.buttons.saving' | translate }}</span>
          } @else {
            <span>{{ 'settings.form.buttons.save' | translate }}</span>
          }
        </button>
      </form>
    </div>
  </div>
</div>

